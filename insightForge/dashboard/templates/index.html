{% extends "dashboard/base.html" %}
{% block content %}
<h2>Upload and Analyze Data</h2>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {{ upload_form.as_p }}
  <label>
    <input type="checkbox" name="do_transform">
    Convert categorical to numeric
  </label>
  <button type="submit">Run</button>
</form>

{% if raw_rows %}
  <h3>Data Summary</h3>
  <ul>
    <li>Original rows: {{ raw_rows }}</li>
    <li>Columns: {{ cols }}</li>
    <li>Cleaned rows: {{ cleaned_rows }}</li>
  </ul>
{% endif %}

{% if data_preview %}
  <h3>Transformed Data Preview</h3>
  {{ data_preview|safe }}
{% endif %}

{% if mapping %}
  <h3>Categorical to Numeric Mapping</h3>
  {% for col, mp in mapping.items %}
    <details>
      <summary>{{ col }}</summary>
      <ul>
        {% for k, v in mp.items %}
          <li>{{ k }} â†’ {{ v }}</li>
        {% endfor %}
      </ul>
    </details>
  {% endfor %}
{% endif %}

{% if chart_html %}
  <h3>Visualization</h3>
  {{ chart_html|safe }}
{% endif %}
{% endblock %}
