{% extends "dashboard/base.html" %}
{% block content %}
<div class="container">
  <h2>ðŸ“„ Comprehensive Data Analysis Report</h2>
  
  <!-- Report Controls -->
  <div class="card">
    <h3>ðŸ“‹ Report Actions</h3>
    <div class="grid grid-2">
      <a href="{% url 'dashboard:report' %}?download=1" class="button">ðŸ“¥ Download Report</a>
      <a href="{% url 'dashboard:index' %}" class="button">ðŸ”„ Back to Analysis</a>
    </div>
  </div>

  <!-- Report Content -->
  {% if report_html %}
  <div class="card">
    <h3>ðŸ“Š Report Preview</h3>
    <div style="border: 1px solid var(--border-color); padding: 20px; border-radius: 8px; max-height: 600px; overflow-y: auto; background: var(--bg-secondary);">
      {{ report_html|safe }}
    </div>
  </div>
  {% endif %}

  <!-- Individual Report Sections -->
  {% if report_sections %}
  <div class="card">
    <h3>ðŸ“‘ Report Sections</h3>
    {% for section in report_sections %}
    <div class="report-section" style="margin-bottom: 20px; padding: 15px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-card);">
      {{ section|safe }}
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Data Summary -->
  {% if data_summary %}
  <div class="card">
    <h3>ðŸ“ˆ Session Data Summary</h3>
    <div class="grid grid-2">
      <div>
        <p><strong>Analyst:</strong> {{ username }}</p>
        <p><strong>Original Rows:</strong> {{ data_summary.original_rows|default:"N/A" }}</p>
        <p><strong>Original Columns:</strong> {{ data_summary.original_columns|default:"N/A" }}</p>
        <p><strong>Cleaned Rows:</strong> {{ data_summary.cleaned_rows|default:"N/A" }}</p>
      </div>
      <div>
        <p><strong>Duplicates Removed:</strong> {{ data_summary.duplicates_removed|default:"N/A" }}</p>
        <p><strong>Missing Values Filled:</strong> {{ data_summary.missing_values_filled|default:"N/A" }}</p>
        <p><strong>Final Columns:</strong> {{ data_summary.final_columns|length|default:"N/A" }}</p>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Generate New Report -->
  <div class="card">
    <h3>ðŸ”„ Regenerate Report</h3>
    <p>Generate a fresh report with all current analysis results.</p>
    <a href="{% url 'dashboard:report' %}" class="button">ðŸ”„ Refresh Report</a>
  </div>
</div>

<style>
.report-section {
  transition: all 0.3s ease;
}

.report-section:hover {
  box-shadow: 0 4px 8px var(--shadow);
  transform: translateY(-2px);
}

@media print {
  .card {
    break-inside: avoid;
    page-break-inside: avoid;
  }
  
  .button {
    display: none;
  }
}
</style>
{% endblock %}
